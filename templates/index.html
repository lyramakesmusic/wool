<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loom</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=IBM+Plex+Serif:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="/static/css/style.css">
</head>

<body>
    <svg id="canvas" width="100%" height="100vh">
        <defs>
            <pattern id="dot-grid" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse">
                <circle cx="1" cy="1" r="1.2" fill="#8B8B8B" opacity="0.25" />
            </pattern>
            <pattern id="dot-grid-dark" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse">
                <circle cx="1" cy="1" r="1.2" fill="#444444" opacity="0.4" />
            </pattern>
        </defs>

        <g id="viewport" transform="translate(0,0) scale(1)">
            <rect id="canvas-bg" x="-10000" y="-10000" width="20000" height="20000" fill="url(#dot-grid)" />
            <g id="edges"></g>
            <g id="nodes"></g>
        </g>
    </svg>

    <div id="settings-panel" class="floating-panel">
        <div class="panel-header">
            Settings
            <button class="panel-toggle" id="settings-toggle">
                <i class="bi bi-chevron-down"></i>
            </button>
        </div>

        <div class="panel-body" id="settings-body">
            <div class="control-group">
                <label>Seed</label>
                <textarea id="seed-input" placeholder="Enter a seed... (Enter to submit, Shift+Enter for newline)"
                    rows="2"></textarea>
                <button id="restart-seed-btn" class="autoformat-btn">Restart from Seed</button>
            </div>

            <div class="control-group">
                <label>Model / Endpoint</label>
                <input type="text" id="model-input" value="moonshotai/kimi-k2"
                    placeholder="provider/model or http://...">
                <div class="help-text">
                    anthropic/claude-opus-4.5<br>
                    moonshotai/kimi-k2::deepinfra<br>
                    http://localhost:8080/v1
                </div>
                <div class="detected-text">
                    Detected: <span id="provider-detected">OpenRouter</span>
                </div>
            </div>

            <div class="control-group">
                <label>API Key</label>
                <input type="password" id="api-key-input" value="" placeholder="Enter to update token">
            </div>

            <!-- OAI-specific controls (shown only for OpenAI-compatible endpoints) -->
            <div class="control-group oai-controls" id="oai-key-group" style="display: none;">
                <label>Session API Key</label>
                <input type="password" id="oai-api-key-input" placeholder="Optional, not saved to disk">
                <div class="help-text">For this session only</div>
            </div>

            <div class="control-group oai-controls" id="oai-model-group" style="display: none;">
                <label>Model</label>
                <input type="text" id="oai-model-input" placeholder="Model name (optional)">
            </div>

            <div class="control-group">
                <label>
                    Temperature
                    <input type="number" class="value-display" id="temp-value" min="0" max="2" step="0.1" value="0.9">
                </label>
                <input type="range" id="temp-slider" min="0" max="2" step="0.1" value="0.9">
            </div>

            <div class="control-group">
                <label>
                    Min P
                    <input type="number" class="value-display" id="minp-value" min="0" max="1" step="0.01" value="0.01">
                </label>
                <input type="range" id="minp-slider" min="0" max="1" step="0.01" value="0.01">
            </div>

            <div class="control-group">
                <label>Siblings</label>
                <input type="number" id="siblings-input" min="1" max="8" step="1" value="3">
            </div>

            <div class="control-group">
                <label>Max Tokens</label>
                <input type="number" id="max-tokens" value="32" min="1" max="2000">
            </div>

            <div class="control-group">
                <label>
                    <input type="checkbox" id="untitled-toggle" class="switch">
                    <span>Untitled.txt Trick</span>
                </label>
            </div>

            <div class="control-group">
                <label>
                    <input type="checkbox" id="dark-mode-toggle" class="switch">
                    <span>Dark Mode</span>
                </label>
            </div>

            <button id="download-tree-btn" class="autoformat-btn">Download Tree as JSON</button>

            <button id="import-tree-btn" class="autoformat-btn">Import Tree</button>
            <input type="file" id="import-tree-input" accept=".json" style="display: none;">

            <button id="autoformat-btn" class="autoformat-btn">Autoformat Tree</button>
        </div>
    </div>

    <!-- Error Toast -->
    <div class="toast-container">
        <div id="error-toast" class="error-toast" role="alert">
            <div class="toast-header">
                <i class="bi bi-exclamation-triangle-fill"></i>
                <strong>API Error</strong>
                <button class="toast-close" aria-label="Close">Ã—</button>
            </div>
            <div class="toast-body" id="error-toast-body">
                <!-- Error message will be inserted here -->
            </div>
        </div>
    </div>

    <script src="/static/js/tree.js"></script>
    <script src="/static/js/rendering.js"></script>
    <script src="/static/js/canvas.js"></script>
    <script src="/static/js/generation.js"></script>
    <script src="/static/js/app.js"></script>
</body>

</html>